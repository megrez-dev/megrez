(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cfec1636"],{"051d":function(t,e,a){"use strict";a("b6a4")},"157a":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"megrez-image",style:t.$attrs.style,on:{mouseenter:function(e){t.maskVisable=!0},mouseleave:function(e){t.maskVisable=!1}}},[t.loading?a("div",{staticClass:"megrez-image-loading"},[a("LoadingIcon")],1):t._e(),a("img",{staticClass:"megrez-image-img",style:t.imageStyle,attrs:{src:t.error?t.fallbackSrc:t.src,alt:t.alt}}),a("div",{staticClass:"megrez-image-mask",style:{opacity:t.maskVisable?1:0,cursor:t.$slots.maskInner?"default":"pointer"},on:{click:t.handleMaskClick}},[!t.$slots.maskInner&&t.preview?a("span",[a("BrowseIcon"),t._v(t._s("string"===typeof t.preview?t.preview:"预览"))],1):t._t("maskInner")],2)])},s=[],n=a("0154"),r=a("7ee6"),o=a("2b0e"),l=a("b25f"),c=a("6be3"),u=(a("4d26"),a("febf"),["size"]);function h(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?h(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var p={tag:"svg",attrs:{fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8 1.5a6.5 6.5 0 000 13v-1.63A4.87 4.87 0 1112.88 8h1.62A6.5 6.5 0 008 1.5z",fillOpacity:.9}}]},m=o["default"].extend({name:"LoadingIcon",functional:!0,props:{size:{type:String},onClick:{type:Function}},render:function(t,e){var a=e.props,i=e.data,s=a.size,n=Object(r["a"])(a,u),o=Object(c["a"])(s),h=o.className,m=o.style,g=d(d({},n||{}),{},{id:"loading",icon:p,staticClass:h,style:m});return i.props=g,t(l["a"],i)}}),g=a("4abd"),f=a("491f");const b=()=>void 0!==document.documentElement.style.objectFit,y={NONE:"none",CONTAIN:"contain",COVER:"cover",FILL:"fill",SCALE_DOWN:"scale-down"};var v={name:"MegrezImage",components:{LoadingIcon:m,BrowseIcon:g["a"]},props:{src:String,alt:String,fit:String,fallback:String,preview:{type:[Boolean,String],default:!0},viewerOptions:{type:Object,required:!1,default:()=>({})},maskClass:{type:String||Array,required:!1,default:""}},data(){return{error:!1,loading:!0,imageWidth:0,imageHeight:0,maskVisable:!1}},computed:{imageStyle(){const{fit:t}=this;return t?b()?{"object-fit":t}:this.getImageStyle(t):{}},fallbackSrc(){return this.fallback||f["a"]}},mounted(){this.loadImage()},methods:{loadImage(){this.loading=!0,this.error=!1;const t=new Image;t.onload=e=>this.handleLoad(e,t),t.onerror=this.handleError.bind(this),t.src=this.src},handleLoad(t,e){this.imageWidth=e.width,this.imageHeight=e.height,this.loading=!1,this.error=!1,this.$emit("load",t)},handleError(t){this.loading=!1,this.error=!0,this.$emit("error",t)},handleMaskClick(t){this.$emit("maskClick",t),!this.$slots.maskInner&&this.preview&&this.handlePreview()},handlePreview(){this.$viewerApi({images:[this.src],options:{...f["b"],...this.viewerOptions}})},getImageStyle(t){const{imageWidth:e,imageHeight:a}=this,{clientWidth:i,clientHeight:s}=this.$el;if(!e||!a||!i||!s)return{};const n=e/a,r=i/s;if(t===y.SCALE_DOWN){const n=e<i&&a<s;t=n?y.NONE:y.CONTAIN}switch(t){case y.NONE:return{width:"auto",height:"auto"};case y.CONTAIN:return n<r?{width:"auto"}:{height:"auto"};case y.COVER:return n<r?{height:"auto"}:{width:"auto"};default:return{}}}}},w=v,O=(a("051d"),a("2877")),k=Object(O["a"])(w,i,s,!1,null,"031a8c61",null);e["a"]=k.exports},"3d06":function(t,e,a){"use strict";a("c57f")},4081:function(t,e,a){},"491f":function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return s}));const i="http://119.91.26.252:8090/images/placeholder.jpg",s={movable:!1,title:!1,navbar:!1,toolbar:{zoomIn:4,zoomOut:4,oneToOne:4,reset:4,prev:0,play:0,next:0,rotateLeft:4,rotateRight:4,flipHorizontal:0,flipVertical:0}}},"6e37":function(t,e,a){"use strict";a("f47b")},b6a4:function(t,e,a){},c57f:function(t,e,a){},de300:function(t,e,a){"use strict";a("4081")},f06c:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("t-drawer",{attrs:{header:"附件列表",visible:t.visible,onClose:t.close,closeBtn:!0,size:"400px",zIndex:2600,onOverlayClick:t.close,placement:"right"},scopedSlots:t._u([{key:"footer",fn:function(){return[a("t-button",{on:{click:t.onClickUpload}},[a("UploadIcon",{attrs:{slot:"icon"},slot:"icon"}),t._v(" 上传附件 ")],1),"multiple"===t.mode?a("span",{staticClass:"complete-button"},[a("t-button",{attrs:{theme:"danger",disabled:t.selectedNum<=0},on:{click:t.onClickComplete}},[t._v(" 完成"+t._s(t.maxNum>0?"("+t.selectedNum+"/"+t.maxNum+")":"")+" ")])],1):t._e()]},proxy:!0}])},[a("t-row",{attrs:{gutter:[16,16]}},[a("t-col",[a("t-input",{attrs:{placeholder:"通过关键词搜索"},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}})],1)],1),a("t-skeleton",{staticClass:"images-skeleton",attrs:{animation:"gradient",loading:t.loading,delay:300}},[a("div",{staticClass:"images-wrapper"},t._l(t.attachments,(function(e,i){return a("m-image",{key:e.id,staticClass:"image-item",class:t.getIndexInSelected(e)>=0?"image-selected":"",attrs:{fit:"cover",src:e.url},on:{maskClick:function(a){return t.handleMaskClick(e,i)}}},[a("template",{slot:"maskInner"},[a("span",{staticStyle:{cursor:"pointer"},on:{click:function(a){return a.stopPropagation(),t.previewImage(e.url)}}},[a("BrowseIcon",{attrs:{size:"1.1em"}}),t._v(" 预览 ")],1),a("t-divider",{attrs:{layout:"vertical"}}),a("span",{staticStyle:{cursor:"pointer"},on:{click:function(a){return a.stopPropagation(),t.previewAttach(e)}}},[a("InfoCircleIcon",{attrs:{size:"1.1em"}}),t._v(" 详情 ")],1)],1)],2)})),1)]),a("t-pagination",{attrs:{current:t.pagination.pageNum,total:t.pagination.total,pageSizeOptions:[]},on:{change:t.onPaginationChange}})],1),a("AttachDetailDrawer",{ref:"attachDetailDrawer"}),a("AttachUploadDialog",{ref:"attachUploadDialog",on:{uploadSuccess:t.syncData}})],1)},s=[],n=(a("14d9"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("t-dialog",{attrs:{visible:t.visible,header:null,confirmBtn:null,cancelBtn:null,onClose:t.close,zIndex:2601}},[a("div",{staticClass:"upload-container"},[a("t-upload",{attrs:{theme:"image",onSuccess:t.handleUploadSuccess,onFail:t.handleUploadFail,requestMethod:t.uploadMethod,draggable:"",accept:"image/*"},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}})],1)])}),r=[],o={name:"AttachUploadDialog",data(){return{visible:!1,files:[]}},computed:{},methods:{open(){this.visible=!0},close(){this.visible=!1},handleUploadFail(){},handleUploadSuccess(){this.$message.success("上传成功"),this.$emit("uploadSuccess"),this.files=[],this.close()},uploadMethod(t){return new Promise(e=>{t.percent=0;let a=new FormData;a.append("file",t.raw),this.$request.post("upload",a,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{0===t.status&&e({status:"success",response:{url:t.data.url}})}).catch(()=>{e({status:"fail",error:"上传失败，请检查文件是否符合规范"})})})}}},l=o,c=(a("de300"),a("2877")),u=Object(c["a"])(l,n,r,!1,null,"30538db6",null),h=u.exports,d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("t-drawer",{attrs:{header:"附件详情",visible:t.visible,onClose:t.close,closeBtn:!0,size:"480px",zIndex:2600,onOverlayClick:t.close,placement:"right"},scopedSlots:t._u([{key:"footer",fn:function(){return[a("t-button",{on:{click:t.deleteAttach}},[t._v("删除")])]},proxy:!0}])},[t.attachment?a("t-list",{attrs:{split:!0}},[a("t-list-item",[a("t-list-item-meta",{attrs:{title:"附件名"}}),t._v(" "+t._s(t.attachment.fileName)+" ")],1),a("t-list-item",[a("t-list-item-meta",{attrs:{title:"存储位置"}}),t._v(" "+t._s(t.attachmentStorageType)+" ")],1),a("t-list-item",[a("t-list-item-meta",{attrs:{title:"图片大小"}}),t._v(" "+t._s(t.attachment.size)+" ")],1),a("t-list-item",[a("t-list-item-meta",{attrs:{title:"图片尺寸"}}),t._v(" "+t._s(t.attachment.height)+" x "+t._s(t.attachment.width)+" ")],1),a("t-list-item",[a("t-list-item-meta",{attrs:{title:"上传日期"}}),t._v(" "+t._s(t.attachment.uploadTime)+" ")],1),a("t-list-item",{scopedSlots:t._u([{key:"action",fn:function(){return[a("t-button",{attrs:{variant:"text",shape:"square"},on:{click:t.copyURL}},[a("file-copy-icon")],1)]},proxy:!0}],null,!1,320530126)},[a("t-list-item-meta",{attrs:{title:"图片链接"}}),t._v(" "+t._s(t.attachment.url)+" ")],1),a("t-list-item",{scopedSlots:t._u([{key:"action",fn:function(){return[a("t-button",{attrs:{variant:"text",shape:"square"},on:{click:t.copyMarkdown}},[a("file-copy-icon")],1)]},proxy:!0}],null,!1,765174242)},[a("t-list-item-meta",{attrs:{title:"Markdown 链接"}}),t._v(" !["+t._s(t.attachment.fileName)+"]("+t._s(t.attachment.url)+") ")],1)],1):t._e()],1)],1)},p=[],m=a("4630"),g={name:"AttachDetailDrawer",data(){return{attachment:{},visible:!1}},computed:{attachmentStorageType(){switch(this.attachment.type){case"local":return"本地";case"qcloud_cos":return"腾讯云 COS";case"aliyun_oss":return"阿里云 OSS";case"huawei_obs":return"华为 OBS";case"qiniuyun":return"七牛云";case"youpaiyun":return"又拍云";default:return"未知"}}},methods:{open(t){this.visible=!0,this.attachment=t},close(){this.visible=!1},deleteAttach(){this.$message.info("未实现")},copyURL(){this.$copyText(this.attachment.url),this.$message.success("已复制")},copyMarkdown(){this.$copyText(`![${this.attachment.fileName}](${this.attachment.url})`),this.$message.success("已复制")}},components:{FileCopyIcon:m["a"]}},f=g,b=(a("6e37"),Object(c["a"])(f,d,p,!1,null,"25d0abba",null)),y=b.exports,v=a("157a"),w=a("491f"),O=a("abb0"),k=a("4abd"),S=a("0154"),C=a("7ee6"),I=a("2b0e"),_=a("b25f"),j=a("6be3"),$=(a("4d26"),a("febf"),["size"]);function N(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function x(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?N(Object(a),!0).forEach((function(e){Object(S["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var z={tag:"svg",attrs:{fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M7.5 12V6.5h1V12h-1zM8.6 4H7.4v1.2h1.2V4z",fillOpacity:.9}},{tag:"path",attrs:{fill:"currentColor",d:"M1 8a7 7 0 1014 0A7 7 0 001 8zm1 0a6 6 0 1112 0A6 6 0 012 8z",fillOpacity:.9}}]},D=I["default"].extend({name:"InfoCircleIcon",functional:!0,props:{size:{type:String},onClick:{type:Function}},render:function(t,e){var a=e.props,i=e.data,s=a.size,n=Object(C["a"])(a,$),r=Object(j["a"])(s),o=r.className,l=r.style,c=x(x({},n||{}),{},{id:"info-circle",icon:z,staticClass:o,style:l});return i.props=c,t(_["a"],i)}}),A={name:"AttachSelectDrawer",components:{AttachUploadDialog:h,AttachDetailDrawer:y,MImage:v["a"],UploadIcon:O["a"],BrowseIcon:k["a"],InfoCircleIcon:D},data(){return{hasInit:!1,keywords:"",attachments:[],loading:!1,selectedAttaches:[],pagination:{pageSize:10,pageNum:1,total:0}}},props:{mode:{type:String,required:!1,default:"single"},visible:{type:Boolean,required:!1,default:!1},maxNum:{type:[Number,String],default:0}},computed:{selectedNum(){return this.selectedAttaches.length}},watch:{visible(t){if(t){if(this.$emit("open"),this.hasInit)return;this.hasInit=!0,this.syncData()}else this.$emit("close")}},methods:{close(){this.$emit("update:visible",!1),this.$emit("close"),this.selectedAttaches=[]},onClickUpload(){this.$refs.attachUploadDialog.open()},onPaginationChange(t){if(t){const{current:e,pageSize:a}=t;this.pagination={...this.pagination,pageNum:e,pageSize:a}}this.syncData()},syncData(){this.loading=!0;const{pageNum:t,pageSize:e}=this.pagination;this.$request.get("attachments",{params:{pageNum:t,pageSize:e}}).then(t=>{0===t.status?(this.pagination.total=t.data.total,this.attachments=t.data.list||[]):this.$message.error("获取附件列表失败")}).catch(()=>{this.$message.error("获取附件列表失败")}).finally(()=>{this.loading=!1})},previewAttach(t){this.$refs.attachDetailDrawer.open(t)},previewImage(t){this.$viewerApi({images:[t],options:w["b"]})},handleMaskClick(t){const e=this.getIndexInSelected(t);e>=0?this.unSelect(e):this.select(t)},getIndexInSelected(t){return this.selectedAttaches.findIndex(e=>e.id===t.id)},select(t){const e=Number(this.maxNum);if(!(e>0&&e<=this.selectedNum))return this.selectedAttaches.push(t),"single"===this.mode?(this.$emit("select",t),void this.close()):void 0;this.$message.warning("最多只能选择"+e+"个附件")},unSelect(t){this.selectedAttaches.splice(t,1)},onClickComplete(){this.$emit("select",this.selectedAttaches),this.close()}}},P=A,E=(a("3d06"),Object(c["a"])(P,i,s,!1,null,"15c73856",null));e["a"]=E.exports},f47b:function(t,e,a){}}]);
//# sourceMappingURL=chunk-cfec1636.b22ffa80.js.map